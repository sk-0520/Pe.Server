name: "Cron Develop Daily"

on:
  schedule:
    - cron: "30 16 * * *"
  workflow_dispatch:

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
      - name: <Checkout> Repository
        uses: actions/checkout@v3

      - name: <Add> Node/NPM
        uses: actions/setup-node@v3
        with:
          node-version-file: ./.node-version

      - name: <Setup> PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.2'
          extensions: sqlite3, mbstring, zip, xml, gd, xdebug
          coverage: xdebug

      - name: <Install> NPM
        run: npm ci

      - name: <Build> front-end
        shell: bash
        run: npm run build

      - name: <Build> back-end
        shell: bash
        run: ./dev/update-config.sh ${{ github.sha }}

      - name: <Test> front-end
        shell: bash
        run: npm run test

      - name: <Test> code
        shell: bash
        run: ./dev/code.sh

      - name: <Test> back-end
        shell: bash
        run: ./dev/test.sh

      - name: <Generate> document
        shell: bash
        run: ./dev/doc.sh

      - name: <Archive> Application
        shell: bash
        run: tar cfv public_html.tar public_html

      - name: <Artifact> Application
        uses: actions/upload-artifact@v3
        with:
          name: public_html
          path: public_html.tar
